<!DOCTYPE html>
<html>
<head>
	<title>Demo for mcverify</title>
	<link rel="stylesheet" href="https://cdn.hell.sh/uikit/3.0.3/uikit.css" integrity="sha384-lFY28ULhQ2AiqfvriJizDVK5iE52SU+KE2vWYnl8GiWLYrFdwK15ausceZU7vY+K" crossorigin="anonymous">
</head>
<body class="uk-margin-left uk-margin-right">
	<div class="uk-container">
		<div class="uk-margin-top uk-margin-bottom">
			<h1>Demo for <a href="https://github.com/timmyrs/mcverify">mcverify</a></h1>
			<p id="info">Please enable Javascript.</p>
		</div>
	</div>
	<script>
		var info = document.getElementById("info");

		info.innerHTML = "Wait just a moment...";

		function sendRequest(path, callback)
		{
			var xhr = new XMLHttpRequest();
			xhr.onreadystatechange = function()
			{
				if(xhr.readyState == 4)
				{
					if(xhr.status == 200)
					{
						callback(xhr.responseText);
					}
					else
					{
						alert("There was an unexpected issue.");
					}
				}
			};
			xhr.open("GET", path);
			xhr.send();
		}

		function awaitCompletion(challenge, callback)
		{
			sendRequest("https://api.mcverify.de/status/" + challenge, function(res)
			{
				if(res != "{}")
				{
					callback(JSON.parse(res));
				}
				else
				{
					setTimeout(function()
					{
						awaitCompletion(challenge, callback);
					}, 4000);
				}
			});
		}

		sendRequest("https://api.mcverify.de/start?service=the%20website", function(res)
		{
			info.innerHTML = "Start Minecraft (1.8 - 1.13.2) and \"Direct Connect\" to <b>" + res + "</b>.";
			setTimeout(function()
			{
				awaitCompletion(res, function(data)
				{
					info.innerHTML = "Thanks, " + data.username + ". Your UUID is " + data.uuid + ".";
				});
			}, 7000);
		});
	</script>
</body>
</html>
